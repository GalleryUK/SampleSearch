#include "SampleSearch.h"#include "Globals.h"#include <Movies.h>#include <SoundInput.h>void SetUpMovies();#include <Aliases.h>#include <Folders.h>#include <Sound.h>#include <ImageCompression.h>extern FSSpec theApplSpec;void MakeSnd(FSSpec *);FSSpec CDRecord(void);FSSpec CDRecord(void){	StandardFileReply		sfr;		/* New-style SF reply */	SFTypeList	types =	{'TRAK'};	short		numtypes = 1;						SetUpMovies();	StandardGetFilePreview(0, -1, 0, &sfr);		/* No need to make an FSSpec record for the file 		because StandardGetFilePreview returns one as part of its StandardFileReply */	ExitMovies();	if (!sfr.sfGood)	{		sfr.sfFile.vRefNum = -999;	}	return sfr.sfFile;}/**************************************************** SetUpMovies() Initializes the movie tools****************************************************/void SetUpMovies(){	OSErr theErr;	theErr = EnterMovies();		/* This would normally with the other manager inits */	if (theErr) DebugStr((StringPtr)"\pEnterMovies Failed");	}void MakeSnd(FSSpecPtr fs){	short refNum, resID = 0;	Movie movie;	OSErr err;	StandardFileReply reply;	Handle h;	FSSpec	tempSpec;	Str255	tempTitle = "\pTempAIFF";	short aiffRef;	short numChannels, sampleSize;	Fixed sampleRate;	OSType	compressionType = 'none';	long numBytes=0,numFrames=0;	OSErr	iErr;	short chanMode,iRefNum;		SetUpMovies();	if (err = OpenMovieFile(fs, &refNum, fsRdPerm))	{		genError ("\pOpen Movie Failed");		ExitMovies();		return;	}	if (err = NewMovieFromFile(&movie, refNum, &resID, nil, newMovieActive, nil))	{		genError ("\pNew Movie Failed");		ExitMovies();		return;	}	err = CloseMovieFile(refNum);		// Maybe make default name based on movie name?		iErr = FSMakeFSSpec(theApplSpec.vRefNum,theApplSpec.parID,"\pSSTempConvFile",&(reply.sfFile));	if (iErr != -43)			FSpDelete(&reply.sfFile);					BlockMove (&reply.sfFile, &tempSpec, 70L);		BlockMove (tempTitle, tempSpec.name, 9L);		 		FSpCreateResFile(&reply.sfFile, 'movr', 'sfil', -1);	/*make temp S7 file */		iRefNum= CurResFile();		refNum = FSpOpenResFile(&reply.sfFile, fsWrPerm);		h = NewHandle(1024);		err = PutMovieIntoTypedHandle(movie, 0, 'snd ', h, 0, GetMovieDuration(movie), 0, 0);		if (!err)			AddResource(h, 'snd ', 128, reply.sfFile.name);		else		{			genError ("\pA problem occurred, you may not have enough memory for that operation");			UseResFile(iRefNum);			ExitMovies();			return;		}		CloseResFile(refNum);				iErr = FSpCreate(&tempSpec,'MgAl','AIFF',0);		if (iErr != 0)		{			genError ("\pCan't create temp AIFF file");			UseResFile(iRefNum);			ExitMovies();			return;		}		iErr = FSpOpenDF(&tempSpec,fsCurPerm,&aiffRef);		if (iErr != 0)		{			genError ("\pCan't open temp AIFF file");			UseResFile(iRefNum);			ExitMovies();			return;		}		refNum = FSpOpenResFile(&reply.sfFile, fsWrPerm);		if (refNum == -1)		{			genError ("\pCan't open Snd Res file");			UseResFile(iRefNum);			ExitMovies();			return;		}		h = GetResource('snd ',128);		chanMode = (short)((*h)+6);		numChannels = (chanMode = initMono) ? 1:2;		sampleRate = (Fixed)((*h)+28);		sampleSize = (Fixed)((*h)+28);		/* find out specs of file */				iErr = SetupAIFFHeader(aiffRef,numChannels,sampleRate,sampleSize,compressionType,numBytes,numFrames);		/* do the conversion into a new file */						FSpDelete(fs);		/* now rename our file as fs */		iErr = FSpRename(&tempSpec,(*fs).name);		FSpDelete(&reply.sfFile);		UseResFile(iRefNum);		ExitMovies();	return;}