#include "SampleSearch.h"#include "Globals.h"#include <Types.h>#include <FixMath.h>#include <math.h>Boolean getAIFFDataII (FSSpec mySpec, long* theRate, short* theWordSize, short* chans, long* theBytes);Boolean SD2toAIFF(FSSpec mySpec);Boolean SD2toAIFF(FSSpec mySpec){ 	FSSpec destSpec;	Str255 aiffType = "[AIFF]";	OSErr	iErr,i2Err;	short SrefNum,DrefNum, thecurfile, fRefNum;	Handle	dataHandle;	OSType formType = 'FORM';	OSType	commType = 'COMM';	OSType  ssndType = 'SSND';	OSType aiff2Type = 'AIFF';	long inOutCount;	long tempLong;	short numChans;	long numSamples;	short sampleSize;	double_t sampleRate;	Fixed samplerate;	Handle 	hRsrc;	char	mysampsize;	Str255	sampsize;	Str255	samprate;	char	mychans;	Str255	chans;	long xx;		long theRate;	short theWordSize;	short channels; 	long theBytes;	getAIFFDataII (mySpec,&theRate, &theWordSize,&channels, &theBytes);		BlockMove (&mySpec, &destSpec,70L);	if (*destSpec.name < 58)	{		BlockMove (aiffType,(destSpec.name + (*destSpec.name)),6);		*destSpec.name += 6;	}	else	{		BlockMove (aiffType,(destSpec.name + 57),6L);		*destSpec.name = 63;	}		FSpCreateResFile(&destSpec,'MgAl','AIFF',0);	iErr = ResError();	if (iErr !=0)	{		SysBeep(5);		return false;	}	dataHandle = NewHandle(32768);	if (!dataHandle)	{		genError ("\pCan't Allocate memory for copy");		return;	}	iErr = FSpOpenDF(&mySpec,fsCurPerm,&SrefNum);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	/*****************/	thecurfile = CurResFile();	fRefNum = FSpOpenResFile(&mySpec,fsCurPerm);	iErr = ResError();	if (iErr!=0)		genErrorN("\pError opening res file",iErr);			UseResFile(fRefNum);	iErr = ResError();	if (iErr!=0)		genErrorN("\pError using res file",iErr);		hRsrc = Get1Resource('STR ',1000);	if (hRsrc == 0)		genErrorN("\pError getting ID1000",0);	mysampsize =*(*hRsrc+1);	*sampsize = 1;	*(sampsize+1) = mysampsize;	StringToNum(sampsize,&xx);	sampleSize = LoWord(xx);		hRsrc = Get1Resource('STR ',1001);	if (hRsrc == 0)		genErrorN("\pError getting ID1001",0);	BlockMove (*hRsrc,samprate,26L);	if (*(samprate + 5L) == '.')				*samprate = 4;			else				*samprate = 5;	StringToNum(samprate,&samplerate);	samplerate = samplerate * 65536L;			sampleRate = Fix2X(samplerate);		hRsrc = Get1Resource('STR ',1002);	if (hRsrc == 0)		genErrorN("\pError getting ID1002",0);	mychans =*(*hRsrc+1);	*chans = 1;	*(chans+1) = mychans;	StringToNum(chans,&xx);	numChans = LoWord(xx);	CloseResFile(fRefNum);		iErr = ResError();	if (iErr!=0)		genErrorN("\pError closing res file",iErr);	UseResFile(thecurfile);	iErr = ResError();	if (iErr!=0)		genErrorN("\pError using old res file",iErr);		iErr = FSpOpenDF(&destSpec,fsCurPerm,&DrefNum);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 8L;	iErr = FSWrite(DrefNum,&inOutCount,&formType);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 4L;	iErr = FSWrite(DrefNum,&inOutCount,&aiff2Type);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 4L;	iErr = FSWrite(DrefNum,&inOutCount,&commType);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	tempLong = 18L;	inOutCount = 4L;	iErr = FSWrite(DrefNum,&inOutCount,&tempLong);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 2L;	iErr = FSWrite(DrefNum,&inOutCount,&numChans);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 4L;	iErr = FSWrite(DrefNum,&inOutCount,&numSamples);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 2L;	iErr = FSWrite(DrefNum,&inOutCount,&sampleSize);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 12L;	iErr = FSWrite(DrefNum,&inOutCount,&sampleRate);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 4L;	iErr = FSWrite(DrefNum,&inOutCount,&ssndType);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 4L;	tempLong = numSamples * (sampleSize / 8);	iErr = FSWrite(DrefNum,&inOutCount,&tempLong);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 4L;	tempLong = 0L;	iErr = FSWrite(DrefNum,&inOutCount,&tempLong);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	inOutCount = 4L;	tempLong = 0L;	iErr = FSWrite(DrefNum,&inOutCount,&tempLong);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}		while (iErr != eofErr)	{		inOutCount = 32000L;		iErr = FSRead(SrefNum,&inOutCount,*dataHandle);		i2Err = FSWrite(DrefNum,&inOutCount,*dataHandle);	}	/* fill in the sound data */		/* copy the comment */		iErr = SetFPos(DrefNum,0,4L);	inOutCount = 4L;	tempLong = 0 /*length of file */;	iErr = FSWrite(DrefNum,&inOutCount,&tempLong);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}		iErr = FSClose(DrefNum);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}	iErr = FSClose(SrefNum);	if (iErr !=0)	{		SysBeep(5);		DisposHandle(dataHandle);		return false;	}		DisposHandle(dataHandle);	return true;}