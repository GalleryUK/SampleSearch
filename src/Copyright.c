#include "SampleSearch.h"#include "Globals.h"Boolean Copyright (FSSpec mySpec, Str255 theStringA, Str255 theStringB);Str255 theCopyPassword;Boolean CopyrightMany (void);Boolean CopyrightMany (void){	short itemHit;				/** for dialog enquiry **/	DialogPtr	myDlg;			/** for dialog enquiry **/	Handle	iHndl;				/** for dialog enquiry **/	Rect	iRect;				/** for dialog enquiry **/	short	iType;				/** for dialog enquiry **/	Str255 textStr;	Cell theCell;	short theindex,z;	Point localPt;	short  iCtlPart;	Str255 theStringA, theStringB;		myDlg = GetNewDialog(9898,0L,(WindowPtr)-1);	GetDItem(myDlg,3,&iType,&iHndl,&iRect);	SetDItem(myDlg,3,iType,(Handle)NewUserItemProc(MyItemProc),&iRect);	/*	HideDItem(myDlg,10);	HideDItem(myDlg,11);	HideDItem(myDlg,12);*/	SetPort (myDlg);	color.red = 56797;	color.green = 56797;	color.blue = 56797;	RGBBackColor(&color);	ShowWindow(myDlg);	ModalDialog(xAlertFilter,&itemHit);	if (itemHit == 1)	{		GetDItem(myDlg,4,&iType,&iHndl,&iRect);		GetIText(iHndl,theStringA);		GetDItem(myDlg,8,&iType,&iHndl,&iRect);		GetIText(iHndl,theStringB);		GetDItem(myDlg,11,&iType,&iHndl,&iRect);		GetIText(iHndl,theCopyPassword);	}			for (z=0L;z<(long)*theCopyPassword;z++)	{		*(theCopyPassword+z+1L) += 128;	}		DisposDialog(myDlg);	if (itemHit == 2)		return;	SetPt( &theCell, 0,0 );		/* start at top of list  */	watchcursor(true);	while ( LGetSelect( TRUE, &theCell, myList) ) 	{		if (theCell.h == 1 && DisplayedColumns == 1)		{			LNextCell( TRUE, TRUE, &theCell, myList );			break;		}				theindex = (theCell.v * DisplayedColumns) + (theCell.h * (DisplayedColumns != 1));				Copyright ((*therealResults)[theindex], theStringA, theStringB);				LNextCell( TRUE, TRUE, &theCell, myList ); 	/* advance to next */	}	watchcursor(false);	return true;}Boolean Copyright (FSSpec mySpec, Str255 theStringA, Str255 theStringB){	short iRefNum,fRefNum;	Handle	copyrightHandle, copyrightHandleB;	FInfo fndrInfo;	OSErr	iErr;	Handle theOldResources;	Str255 thePass;	long Hardwire = 0x01008000L;	short moreHardwire = 0x0002;	long soFar = 0L;			iRefNum = CurResFile();	fRefNum = FSpOpenResFile(&mySpec,fsCurPerm);	if (fRefNum == -1)	{		iErr = FSpGetFInfo(&mySpec,&fndrInfo);		FSpCreateResFile(&mySpec,fndrInfo.fdCreator,fndrInfo.fdType,0);		fRefNum = FSpOpenResFile(&mySpec,fsCurPerm);		//genError ("\pCan't open file to set Copyright");		//return false;	}	UseResFile(fRefNum);	copyrightHandle = NewHandle(300);	if (!copyrightHandle)	{		genError ("\pNot enough memory to set Copyright");		UseResFile(iRefNum);		return false;	}	/* the password check can't be done until the code does not hardwire the sound */	theOldResources = Get1Resource('vers',1);	if (theOldResources)	{		if  (*((*theOldResources)+6L))		{			BlockMove((*theOldResources)+6L,thePass,256L);			if(EqualString(theCopyPassword,thePass,false,false)) 			{				RmveResource(theOldResources);				ReleaseResource(theOldResources);				DisposHandle(theOldResources);			}			else			{				CloseResFile(fRefNum);				UseResFile(iRefNum);				//DisposHandle(theOldResources);				DisposHandle(copyrightHandle);				SysBeep(5);				return false;			}		}		else		{			RmveResource(theOldResources);			ReleaseResource(theOldResources);			DisposHandle(theOldResources);		}	}		theOldResources = Get1Resource('vers',2);	if (theOldResources)	{		if (*((*theOldResources)+6L))		{			BlockMove((*theOldResources)+6L,thePass,256L);			if(EqualString(theCopyPassword,thePass,false,false)) 			{				RmveResource(theOldResources);				ReleaseResource(theOldResources);				DisposHandle(theOldResources);			}			else			{				CloseResFile(fRefNum);				UseResFile(iRefNum);				//DisposHandle(theOldResources);				DisposHandle(copyrightHandle);				SysBeep(5);				return false;			}		}		else		{			RmveResource(theOldResources);			ReleaseResource(theOldResources);			DisposHandle(theOldResources);		}	}		BlockMove (&Hardwire,*copyrightHandle,4L);	soFar = 4L;	BlockMove (&moreHardwire,(*copyrightHandle)+soFar,2L);	soFar = 6L;	if (*theCopyPassword)	{		BlockMove (theCopyPassword,(*copyrightHandle)+soFar,256L);		soFar += (*theCopyPassword)+1L;	}	BlockMove (theStringA,(*copyrightHandle)+soFar,256L);	soFar += (*theStringA)+1L;	SetHandleSize(copyrightHandle,soFar);	AddResource(copyrightHandle,'vers',2,"\pversion2");	iErr = ResError();	if (iErr!= 0)	{		genError ("\pProblem adding resource");		DisposHandle(copyrightHandle);		CloseResFile(fRefNum);		UseResFile(iRefNum);		return false;	}		copyrightHandleB = NewHandle(300);	if (!copyrightHandleB)	{		genError ("\pNot enough memory to set Copyright");		DisposHandle(copyrightHandle);		CloseResFile(fRefNum);		UseResFile(iRefNum);		return false;	}			BlockMove (&Hardwire,*copyrightHandleB,4L);	soFar = 4L;	BlockMove (&moreHardwire,(*copyrightHandleB)+soFar,2L);	soFar = 6L;	if (*theCopyPassword)	{		BlockMove (theCopyPassword,(*copyrightHandleB)+soFar,256);		soFar += (*theCopyPassword)+1L;	}	BlockMove (theStringB,(*copyrightHandleB)+soFar,256L);	soFar += (*theStringB)+1L;	SetHandleSize(copyrightHandleB,soFar);		AddResource(copyrightHandleB,'vers',1,"\pversion1");	iErr = ResError();	if (iErr!= 0)	{		genError ("\pProblem adding resource");		DisposHandle(copyrightHandle);		DisposHandle(copyrightHandleB);	}	CloseResFile(fRefNum);	UseResFile(iRefNum);	//	DisposHandle(copyrightHandle);//	DisposHandle(copyrightHandleB);			return true;}