#include "SampleSearch.h"#include "Globals.h"#include <Sound.h>#include <Resources.h>#include <SoundInput.h>extern Boolean DialogPresent;void OldSDIIPlay(FSSpec);extern long normBuffer;void CallSndPlay(Handle);void genErrorN(Str255 myText,long Errno);FSSpec	getFile(void);void OldSDIIPlay(FSSpec mySpec){	Handle	mySndH;	short	fRefNum;	short	thecurfile;	Str255	sampsize;	OSErr	iErr;	SndChannelPtr mySndChan;	// pointer to a sound channel	OSErr myErr;	Str255	samprate;	Str255	chans;	char	mysampsize;	long	mysamprate,xx,inOutCount;	char	mychans;	Handle 	hRsrc;	long z;	Fixed	sampleRate;	short 	numChans;	short		numBits;	short	refNum;	short headerLen;	Ptr mySndPtr;			mySndH = NewHandle(normBuffer);	if (!mySndH)	{		genError("\pNot enough memory, increase partition size, or reduce buffer in prefs");		return;	}	thecurfile = CurResFile();	fRefNum = FSpOpenResFile(&mySpec,fsRdPerm);	iErr = ResError();	if (iErr!=0)		genErrorN("\pError opening res file",iErr);			UseResFile(fRefNum);	iErr = ResError();	if (iErr!=0)		genErrorN("\pError using res file",iErr);		hRsrc = Get1Resource('STR ',1000);	if (hRsrc == 0)		genErrorN("\pError getting ID1000",0);	mysampsize =*(*hRsrc+1);	*sampsize = 1;	*(sampsize+1) = mysampsize;	StringToNum(sampsize,&xx);	numBits = LoWord(xx);		hRsrc = Get1Resource('STR ',1001);	if (hRsrc == 0)		genErrorN("\pError getting ID1001",0);	BlockMove (*hRsrc,samprate,28L);	if (*(samprate + 5L) == '.')		*samprate = 4;	else		*samprate = 5;				StringToNum(samprate,&sampleRate);	sampleRate = sampleRate * 65536L;		hRsrc = Get1Resource('STR ',1002);	if (hRsrc == 0)		genErrorN("\pError getting ID1002",0);	mychans =*(*hRsrc+1);	*chans = 1;	*(chans+1) = mychans;	StringToNum(chans,&xx);	numChans = LoWord(xx);	CloseResFile(fRefNum);	iErr = ResError();	if (iErr!=0)		genErrorN("\pError closing res file",iErr);	UseResFile(thecurfile);	iErr = ResError();	if (iErr!=0)		genErrorN("\pError using old res file",iErr);			iErr = SetupSndHeader((SndListResource **)mySndH,numChans,sampleRate,numBits*8,'NONE',0x3C,0,&headerLen);	if (iErr!=0)		genErrorN("\pError setting up snd header 1",iErr);	iErr = FSpOpenDF(&mySpec,fsRdPerm,&refNum);	if (iErr!=0)		genErrorN("\pError opening data fork",iErr);	HLock(mySndH);	//mySndPtr = (*mySndH)+headerLen;	inOutCount = 250000;	watchcursor(TRUE);	iErr = FSRead(refNum,&inOutCount,(*mySndH)+headerLen);	if (iErr!=0 && iErr!=-39)		genErrorN("\pError reading data fork",iErr);	iErr = SetupSndHeader((SndListResource **)mySndH,numChans,sampleRate,numBits*8,'NONE',0x3C,inOutCount,&headerLen);	if (iErr!=0)		genErrorN("\pError setting up snd header 2",iErr);	HUnlock(mySndH);				/** process twos's complement **/	if (numBits ==1)	{		for (z = (long)((*mySndH)+headerLen); z<(long)((*mySndH)+headerLen)+inOutCount;z++)		{			*((Ptr)z) += 128;		}	}			/********************************/		CallSndPlay(mySndH);	DisposHandle(mySndH);		myErr = MemError();	if (myErr!=0)		genErrorN("\pError disposing Handle",myErr);	iErr = FSClose(refNum);	if (iErr!=0)		genErrorN("\pError closing DF",iErr);	watchcursor(false);		}void  CallSndPlay(Handle mySndHandle){	SndChannelPtr mySndChan;	// pointer to a sound channel	OSErr myErr;	// prototype for user defined error handling routine	void DoError(OSErr);	mySndChan = nil;     // Initialize channel pointer for error checking	if ( mySndHandle != nil ) {		myErr = SndPlay ((SndChannel *)mySndChan, (SndListResource **)mySndHandle, false);		if ( myErr )		genErrorN("\pError playing sound",myErr);	}}