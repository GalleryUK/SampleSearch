#include "SampleSearch.h"#include "Globals.h"long findKeyS(short localRefNum);long getSampleCellInstSize (FSSpec mySpec);Boolean GetSizeDate2 (FSSpec mySpec, long* theSize, long* theDate);long getSampleCellInstSize (FSSpec mySpec){	OSErr	iErr;	short refNum;	long theSize;	long theOffset;	long inOutCount;	FInfo fndrInfo;	long theDate;			iErr = FSpGetFInfo(&mySpec,&fndrInfo);	if (fndrInfo.fdType != 'SCin' && fndrInfo.fdType != 'SCsi' && fndrInfo.fdType != 'SCsd' && fndrInfo.fdType != 'SCss')	{		GetSizeDate2 (mySpec,&theSize, &theDate);		return theSize;	}		iErr = FSpOpenDF(&mySpec,fsCurPerm,&refNum);	if (iErr != 0)		return 0;			theOffset = findKeyS(refNum);	if (!theOffset)	{		FSClose (refNum);		return 0;	}		iErr = SetFPos(refNum,1,theOffset + 16L);	if (iErr != 0)	{		FSClose (refNum);		return 0;	}		inOutCount = 4L;		iErr = FSRead(refNum,&inOutCount,&theSize);	if (iErr != 0)	{		FSClose (refNum);		return 0;	}	FSClose (refNum);	return theSize;}long findKeyS(short localRefNum){	OSErr	iErr;	Handle	myTempStore;	long inOutCount;	long lOffset;	OSType	filpType = 'KeyS';	short passes = 0;	myTempStore = NewHandle(500);	if (!myTempStore)	{		genError ("\pCannot allocate memory for KeyS handle");		return 0;	}	iErr = SetFPos(localRefNum,1,0L);	if (iErr!=0)		return 0;	while (iErr != eofErr)	{		inOutCount = 490;		iErr = FSRead(localRefNum,&inOutCount,*myTempStore);		if (iErr!=0 && iErr !=eofErr)			return 0;		lOffset = Munger(myTempStore,0,&filpType,4,nil,0);		if (lOffset >= 0)		{			DisposHandle(myTempStore);			return lOffset + (passes*490);		}		passes ++;	}	DisposHandle(myTempStore);	return 0;}Boolean GetSizeDate2 (FSSpec mySpec, long* theSize, long* theDate){	long theResSize = 0L;	long theDataSize = 0L;	long theModDate = 0;	CInfoPBRec	cipbr;				/* local pb */	HFileInfo	*fpb = (HFileInfo *)&cipbr;	/* to pointers */	DirInfo	*dpb = (DirInfo *) &cipbr;	short	rc, idx;	OSErr	iErr;	Str255 zfilename;	long	dirID,myDrDir;	short Fcounter = 0;		BlockMove(mySpec.name,zfilename,64L);	fpb->ioVRefNum = mySpec.vRefNum;		/* default volume */	fpb->ioNamePtr = zfilename;	/* buffer to receive name */	fpb->ioFDirIndex = 0; 	fpb->ioDirID = mySpec.parID;		rc = PBGetCatInfo( &cipbr, FALSE );		if (rc) 			return false;	if (!(fpb->ioFlAttrib & 16)) 	{		theDataSize = fpb->ioFlLgLen;		theResSize = fpb->ioFlRLgLen;		theModDate = fpb->ioFlMdDat;		*theSize = (long)(theDataSize+theResSize);		*theDate = (unsigned long)(theModDate);		return true;	}	else	{		return false;	}}