#include "SampleSearch.h"extern Boolean problemOccurred;OSErr copyFile(FSSpec sourceSpec, FSSpec destspec);OSErr copyFile(FSSpec sourceSpec, FSSpec destspec){	OSErr iErr,theErr;	FInfo fndrInfo;	Ptr copyBuff;	Str255 theStrTemp;	long bytesCopied = 0,inOutCount,bytesToCopy;	short theSource,theDestination;		if (sourceSpec.vRefNum == destspec.vRefNum)	{		if (sourceSpec.parID == destspec.parID)		{				if (EqualString(sourceSpec.name,destspec.name,true,true)) 			{				return 0;			}		}			}		copyBuff = NewPtrClear(131072L);	if (!copyBuff)	{		genError("\pNot Enough memory");		problemOccurred = true;		return 25;	}	problemOccurred = false;	iErr = FSpGetFInfo(&sourceSpec,&fndrInfo);	//iErr = FSMakeFSSpec(theConvertDestLoc.vRefNum,theConvertDestLoc.parID,sourceSpec.name,&destspec);	iErr = FSpCreate(&destspec,fndrInfo.fdCreator,fndrInfo.fdType,0);	if (iErr == -48) 	/** file exists **/	{		genError("\pFile Exists");		return -48;	}			makeStr255 ("\pTransferring:", theStrTemp);	concatStrings(theStrTemp,sourceSpec.name,"\p");	progressCreate (theStrTemp);		iErr = FSpOpenDF(&sourceSpec,fsRdPerm,&theSource);	if (!iErr)	{		iErr = FSpOpenDF(&destspec,fsWrPerm,&theDestination);		if (iErr!=0)		{			progressDispos();			genError("\pCan't open DF of new file");			DisposPtr(copyBuff);			return iErr;		}		theErr = 0;		while(theErr!= eofErr)		{			inOutCount = 131072L;			theErr = FSRead(theSource,&inOutCount,copyBuff);			if (theErr!=0 && theErr != eofErr)			{				progressDispos();				genError("\pCan't read from DF of source file");								DisposPtr(copyBuff);				return theErr;			}			iErr = FSWrite(theDestination,&inOutCount,copyBuff);			if (iErr!=0)			{				progressDispos();				genError("\pCan't write to DF of new file, disk may be full");								DisposPtr(copyBuff);				return iErr;			}			bytesCopied += inOutCount;			if (!bytesToCopy)				bytesToCopy  = 10L; 			if (progressDisp(LoWord (bytesCopied * 100L / bytesToCopy)))			{				DisposPtr(copyBuff);				return -99;			}		}		FSClose(theSource);		FSClose(theDestination);	}			FSpCreateResFile(&destspec,fndrInfo.fdCreator,fndrInfo.fdType,0);	iErr = ResError();	if (iErr!=0)	{		genError("\pCan't create RF of new file");		DisposPtr(copyBuff);		return iErr;	}	iErr = FSpOpenRF(&sourceSpec,fsCurPerm,&theSource);	if (iErr!=0 && iErr != -43)	{		genError("\pCan't open RF of source file");		DisposPtr(copyBuff);		return iErr;	}	if (!iErr)	{		iErr = FSpOpenRF(&destspec,fsCurPerm,&theDestination);		if (iErr!=0)		{			genError("\pCan't open RF of new file");			DisposPtr(copyBuff);			return iErr;		}		theErr = 0;		while(theErr!= eofErr)		{			inOutCount = 131072L;			theErr = FSRead(theSource,&inOutCount,copyBuff);			iErr = FSWrite(theDestination,&inOutCount,copyBuff);			if (iErr!=0)			{				genError("\pCan't write to RF of new file, disk may be full");				DisposPtr(copyBuff);				return -99;			}						if (progressDisp(50))			{				DisposPtr(copyBuff);				return -99;			}								}		FSClose(theSource);		FSClose(theDestination);	}			iErr = FSpGetFInfo(&sourceSpec,&fndrInfo);	FSpSetFInfo(&destspec,&fndrInfo);			progressDispos();	problemOccurred = false;	DisposPtr(copyBuff);	return noErr;}