#include "SampleSearch.h"#include "Globals.h"#include "Folders.h"AliasHandle makeDriveAlias(FSSpecPtr myDriveSpec);AliasHandle makeDriveAlias(FSSpecPtr myDriveSpec){	AliasHandle myVolAlias;	OSErr	iErr;		iErr = NewAlias(0,myDriveSpec,&myVolAlias);	if (iErr !=0)	{		genError ("\pCan't make new alias");	}	return myVolAlias;}FSSpecPtr resolveDriveAlias(AliasHandle myVolAlias);FSSpecPtr resolveDriveAlias(AliasHandle myVolAlias){	FSSpec	myDriveSpec;	OSErr	iErr;	Boolean wasChanged;		myDriveSpec.vRefNum = 0;	iErr = ResolveAlias(0,myVolAlias,&myDriveSpec,&wasChanged);	if (iErr != 0)	{		genError ("\pCan't Find Drive");	}	return &myDriveSpec;}void MakeAliasOnDesk(FSSpecPtr	mySpec, short indy){	OSErr iErr;	short 	deskVRefNum;	long	deskDirID;		FSSpec	myAliasSpec;	Str255	myAliasName;	AliasHandle	aliasH;	FInfo fndrInfo;	short	iRefNum;	short myRefNum;	short z;		if 	(!FInfolistInMem)	{			FInfoArrayPtr = totfindcounter;			//SetHandleSize(theFInfo,totfindcounter * sizeof(FInfo));			iErr = MemError();			if (iErr!=0)				genError("\pCould not expand FInfo in Filterlist");								checkHandleSize ((Handle)theFInfo,totfindcounter,sizeof(FInfo));					for (z=0;z<totfindcounter;z++)				{				iErr = FSpGetFInfo(&(*therealResults)[z],(*theFInfo)+z);			}				FInfolistInMem = true;	}	if (-((*mySpec).vRefNum)>maxVRef)			/** check for ghosts **/	{		genError("\pYou cannot make an alias for ghosts YET");		return;	}	iErr = FindFolder(kOnSystemDisk,'desk',false,&deskVRefNum,&deskDirID);	/** find desktop **/	if (iErr!=0)	{		genError("\pCan't find desktop");		return;	}	myAliasSpec.vRefNum = deskVRefNum;	myAliasSpec.parID = deskDirID;	BlockMove((*mySpec).name,myAliasSpec.name,64L);	iErr = NewAlias(0,mySpec,&aliasH);									/** MAKE ALIAS REC **/	if (iErr!=0)	{		genError("\pCan't create alias Record");		return;	}	BlockMove(&((*theFInfo)[indy]),&fndrInfo,16L);							/** get flags **/	iErr = FSpCreate(&myAliasSpec,fndrInfo.fdCreator,'adrp',0);			/** make file **/	if (iErr!=0)	{		if (iErr == -48)			genError ("\pFileExists");		genError("\pCan't create alias File on desk");		return;	}	iRefNum = CurResFile();	myRefNum = FSpOpenResFile(&myAliasSpec,fsCurPerm);			/** try to open **/	if (myRefNum !=0)		genError("\pProblem opening");		if (myRefNum == -1)			/** no fork **/						/** always fails **/	{		HCreateResFile(myAliasSpec.vRefNum,myAliasSpec.parID,myAliasSpec.name);		/** make res fork **/		iErr = ResError();		if (iErr!=0)		{			genError ("\pCan't create resource fork"); 			return;		}		myRefNum = FSpOpenResFile(&myAliasSpec,fsCurPerm);					/** open it again **/	}	UseResFile(myRefNum);	AddResource((Handle)aliasH,'Alis',0,myAliasSpec.name);							/** add alias resource **/	iErr = ResError();	if (iErr!=0)	{		genError("\pCan't add resource");		return;	}	WriteResource((Handle)aliasH);						/** store to file **=	iErr = ResError();	if (iErr!=0)	{		genError("\pCan't write resource");		return;	}	CloseResFile(myRefNum);					/** close file **/	iErr = ResError();	if (iErr!=0)	{		genError("\pCan't close alias File on desk");		return;	}	iErr = FSpGetFInfo(&myAliasSpec,&fndrInfo);					if (iErr!=0)	{		genError("\pCan't get alias info on desk");		return;	}	fndrInfo.fdFlags = fndrInfo.fdFlags | 0x8001;	iErr = FSpSetFInfo(&myAliasSpec,&fndrInfo);	if (iErr!=0)	{		genError("\pCan't set alias info on desk");		return;	}	UseResFile(iRefNum);	return;}