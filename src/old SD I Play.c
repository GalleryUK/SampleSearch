#include "SampleSearch.h"#include "Globals.h"#include <Sound.h>#include <Resources.h>#include <SoundInput.h>extern long normBuffer;void OldSDIPlay(FSSpec);void CallSndPlay(Handle);void genErrorN(Str255 myText,long Errno);FSSpec	getFile(void);void OldSDIPlay(FSSpec mySpec){	Handle	mySndH;	short	fRefNum;	short	thecurfile;	Str255	sampsize;	OSErr	iErr;	SndChannelPtr mySndChan;	// pointer to a sound channel	OSErr myErr;	Str255	samprate;	Str255	chans;	char	mysampsize;	long	mysamprate,xx,inOutCount;	char	mychans;	Handle 	hRsrc;	long z;	Fixed	sampleRate;	short 	numChans;	short		numBits;	short	refNum,tempchans;	short headerLen;	Ptr mySndPtr;		mySndH = NewHandle(normBuffer);	if (!mySndH)	{		genError("\pNot enough memory, increase partition size, or reduce buffer in prefs");		return;	}		iErr = FSpOpenDF(&mySpec,fsRdPerm,&refNum);	if (iErr!=0)		genErrorN("\pCould not open SDI file to audition",iErr);			iErr = SetFPos(refNum,1,1020);	if (iErr!=0)		genErrorN("\pCould not position in file",iErr);			inOutCount = 4;		iErr = FSRead(refNum,&inOutCount,&mysamprate);	if (iErr!=0)		genErrorN("\pCould not sample rate from SDI file",iErr);	sampleRate = mysamprate;	sampleRate = sampleRate * 65536L;			inOutCount = 2;		iErr = SetFPos(refNum,1,1028);	if (iErr!=0)		genErrorN("\pCould not position in file",iErr);	watchcursor (true);		iErr = FSRead(refNum,&inOutCount,&tempchans);	if (iErr!=0)		genErrorN("\pCould not bit depth from SDI file",iErr);			numBits = tempchans;			numChans = 1;		if (iErr!=0)		genErrorN("\pCould not close SDI file",iErr);			iErr = SetupSndHeader((SndListResource **)mySndH,numChans,sampleRate,numBits,'NONE',0x3C,0,&headerLen);	if (iErr!=0)		genErrorN("\pError setting up snd header 1",iErr);	iErr = SetFPos(refNum,1,1336);	if (iErr!=0)		genErrorN("\pCould not position in file",iErr);	if (iErr!=0)		genErrorN("\pError opening data fork",iErr);	HLock(mySndH);	mySndPtr = (*mySndH)+headerLen;	inOutCount = 250000;		iErr = FSRead(refNum,&inOutCount,mySndPtr);	if (iErr!=0 && iErr!=-39)		genErrorN("\pError reading data fork",iErr);	iErr = SetupSndHeader((SndListResource **)mySndH,numChans,sampleRate,numBits,'NONE',0x3C,inOutCount,&headerLen);	if (iErr!=0)		genErrorN("\pError setting up snd header 2",iErr);	HUnlock(mySndH);				/** process twos's complement **/			/********************************/		CallSndPlay(mySndH);	DisposHandle(mySndH);				iErr = FSClose(refNum);	if (iErr!=0)		genErrorN("\pError closing DF",iErr);	watchcursor (false);	}